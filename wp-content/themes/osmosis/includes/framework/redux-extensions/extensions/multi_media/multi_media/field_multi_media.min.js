(function(b){redux.field_objects=redux.field_objects||{};redux.field_objects.multi_media=redux.field_objects.multi_media||{};redux.field_objects.multi_media.mainID="";var a;redux.field_objects.multi_media.init=function(c){if(!c){c=b(document).find(".redux-container-multi_media")}b(c).each(function(){var e=b(this);var d=e;if(!e.hasClass("redux-field-container")){d=e.parents(".redux-field-container:first")}if(d.hasClass("redux-field-init")){d.removeClass("redux-field-init")}else{return}e.find(".redux_remove_file_button").unbind("click").on("click",function(f){redux.field_objects.multi_media.removeFile(f,b(this).parents("fieldset.redux-field:first"),b(this))});e.find(".redux_upload_button").unbind().on("click",function(f){redux.field_objects.multi_media.addFile(f,b(this).parents("fieldset.redux-field:first"),b(this))});redux.field_objects.multi_media.modInit(e)})};redux.field_objects.multi_media.modInit=function(e){a=redux_multi_media_l10;redux.field_objects.multi_media.mainID=e.attr("data-id");var f=Boolean(e.find(".redux-multi-media-container").data("dev-mode"));if(f===true){var c=e.find(".redux-multi-media-container").data("version");var d=b("div.redux-timer").html();var g=d.indexOf("Multi Media Selector");if(g===-1){b("div.redux-timer").html(d+"<br/>Multi Media Selector extension v."+c)}}};redux.field_objects.multi_media.removeErrMsgs=function(){b("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-file-exists").each(function(d,c){b(c).remove()});b("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-max-limit").each(function(d,c){b(c).remove()})};redux.field_objects.multi_media.selExists=function(c){var d=false;b("#"+redux.field_objects.multi_media.mainID+" .attach_list li").each(function(g,f){var e=b(f).find("input#filelist-"+c);if(e.length!==0){d=true;return}});return d};redux.field_objects.multi_media.addFile=function(d,k,n){d.preventDefault();var g;var i;var h=true;var f=true;var j=n.prev("input").attr("id");var c=b("#"+j);var m=c.attr("name");if(g){g.open();return}redux.field_objects.multi_media.removeErrMsgs();var e=b(k).find(".library-filter").data("lib-filter");var l=b(k).find(".redux-multi-media-container").data("max-file-upload");if(e!==undefined){if(e!==""){i=[];e=decodeURIComponent(e);e=JSON.parse(e);b.each(e,function(o,p){i.push(p)})}}g=wp.media({multiple:h?true:false,title:a.title,library:{type:i},button:{text:a.upload_file}});g.on("select",function(){var r=0;var s=true;var q=g.state().get("selection");var t=q.toJSON();c.val(t.url);b("#"+j+"_id").val(t.id);var o=[];var p=b("#"+redux.field_objects.multi_media.mainID+" .attach_list").children().length;b(t).each(function(){if(l<=0||(r+p)<l){r++;if(redux.field_objects.multi_media.selExists(this.id)){var u=a.dup_warn;u=u.replace("%s","<strong>"+this.filename+"</strong>");f='<li class="redux-file-exists">'+u+"</li>";o.push(f);s=false;return true}if(this.type&&this.type==="image"){f='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="redux_remove_file_button" rel="'+j+"["+this.id+']">'+a.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+m+"["+this.id+']" value="'+this.url+'"></li>'}else{f="<li>"+a.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+a.download+'</a> / <a href="#" class="redux_remove_file_button" rel="'+j+"["+this.id+']">'+a.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+m+"["+this.id+']" value="'+this.url+'"></li>'}o.push(f);s=true}else{var v=a.max_warn;v=v.replace("%s","<strong>"+l+"</strong>");f='<li class="redux-max-limit">'+v+"</li>";o.push(f);return}});b(o).each(function(){c.siblings(".redux_media_status").slideDown().append(this)});g.close();if(s===true){redux_change(b(k).find(".redux_media_status"))}});g.open()};redux.field_objects.multi_media.removeFile=function(f,c,e){f.preventDefault();var h=e;if(h.is(".attach_list .redux_remove_file_button")){h.parents("li").remove();redux_change(b(c).find(".redux_media_status"));return false}var d=h.attr("rel");var g=h.parents(".img_status");c.find("input#"+d).val("");c.find("input#"+d+"_id").val("");if(!g.length){h.parents(".redux_media_status").html("")}else{g.html("")}return false}})(jQuery);